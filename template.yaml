- job-template:
    defaults: global
    name: '{name}-{branch}-build'
    node: jailer_fast
    scm:
      - 'FreeBSD-src-{branch}'
#    triggers:
#      - pollscm: H H/2 * * *
    builders:
#      - build-world-kernel
      - checkout-scripts
      - setup-jail
      - execute-in-jail
    publishers:
      - scan-clang-warnings
      - clean-jail
#      - mail-notify
    wrappers:
      - timestamps
      - timeout:
          timeout: 60
          timeout-var: 'BUILD_TIMEOUT'
          fail: true
          type: absolute

- job-template:
    defaults: global
    name: '{name}-{branch}-arm64-build'
    node: jailer_fast
    scm:
      - 'FreeBSD-src-{branch}'
    builders:
      - checkout-scripts
      - setup-jail
      - execute-in-jail
    publishers:
      - scan-clang-warnings
      - clean-jail
    wrappers:
      - timestamps
      - timeout:
          timeout: 60
          timeout-var: 'BUILD_TIMEOUT'
          fail: true
          type: absolute

- job-template:
    defaults: global
    name: '{name}-{branch}-test'
    scm:
      - 'FreeBSD-src-{branch}'
    triggers:
      - reverse:
          jobs:
            - '{name}-build'
          result: success
    builders:
      - regression-test
    publishers:
      - publish-junit-results
#      - mail-notify

- job-group:
    name: '{name}-{branch}-ci'
    jobs:
       - '{name}-{branch}-build'
       - '{name}-{branch}-test'

- job-group:
    name: '{name}-{branch}-arm64-ci'
    jobs:
       - '{name}-{branch}-arm64-build'
