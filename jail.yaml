- defaults:
    name: global
    project-type: freestyle
    concurrent: false
    disabled: false
    block-downstream: false
    block-upstream: false
    logrotate:
      daysToKeep: -1
      numToKeep: 200
      artifactDaysToKeep: -1
      artifactNumToKeep: -1

- scm:
    name: freebsd-src-head
    scm:
      - svn:
          repos:
            - url: https://svn.freebsd.org/base/head/
              basedir: src
            - url: https://github.com/freebsd/freebsd-ci
              basedir: freebsd-ci
          workspaceupdater: emulateclean
          viewvc-url: https://svnweb.freebsd.org/base/

- builder:
    name: setup-jail
    builders:
      - shell: sh freebsd-ci/scripts/jail/setup.sh

- builder:
    name: execute-in-jail
    builders:
      - shell: sh freebsd-ci/scripts/jail/execute.sh

- publisher:
    name: clean-jail
    publishers:
      - post-tasks:
          - task:
            script: sh freebsd-ci/scripts/jail/clean.sh

- publisher:
    name: scan-clang-warnings
    publishers:
      - warnings:
          console-log-parsers:
            - Clang (LLVM based)

- publisher:
    name: scan-gcc4-warnings
    publishers:
      - warnings:
          console-log-parsers:
            - GNU C Compiler 4 (gcc)

- publisher:
    name: mail-notify
    publishers:
      - email-ext:
          recipients: lwhsu.jenkins@lwhsu.org
          subject: "$PROJECT_NAME - Build #$BUILD_NUMBER - $BUILD_STATUS"
          body: |
            $PROJECT_NAME - Build #$BUILD_NUMBER - $BUILD_STATUS:
            
            Build information: ${BUILD_URL}
            Full change log: ${BUILD_URL}changes
            Full build log: ${BUILD_URL}console
            
            Change summaries:
            
            ${CHANGES, format="%r by %a:\\n%m\\n"}
            
            The end of the build log:
            
            ${BUILD_LOG}
          failure: true
          unstable: true
          fixed: false
          send-to:
            - culprits
            - recipients
      - email-ext:
          recipients: lwhsu.jenkins@lwhsu.org
          subject: "$PROJECT_NAME - Build #$BUILD_NUMBER - $BUILD_STATUS"
          body: |
            $PROJECT_NAME - Build #$BUILD_NUMBER - $BUILD_STATUS:
            
            Build information: ${BUILD_URL}
            Full change log: ${BUILD_URL}changes
            Full build log: ${BUILD_URL}console
            
            Change summaries:
            
            ${CHANGES, format="%r by %a:\\n%m\\n"}
          failure: false
          unstable: false
          fixed: true
          send-to:
            - culprits
            - recipients

- job:
    defaults: global
    name: test-jjb
    node: jailer
    scm:
      - freebsd-src-head
    triggers:
      - pollscm: H H/2 * * *
    builders:
      - setup-jail
      - execute-in-jail
    publishers:
      - clean-jail
      - scan-clang-warnings
      - mail-notify
